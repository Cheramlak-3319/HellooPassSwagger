openapi: 3.1.0
info:
  title: HellOOpass Platform API
  description: |
    # üî• HellOOpass Enterprise API v1.0

    ## üìã Overview
    **HellOOpass** is a comprehensive digital payment and merchant management platform supporting financial inclusion across Africa. This API provides programmatic access to merchant management, customer operations, invoice processing, and WFP (World Food Programme) integration capabilities.

    ### ‚ú® Key Features
    - **Merchant & Customer Management** - Full lifecycle management of merchants and customers
    - **Payment Processing** - Invoice creation, BNPL (Buy Now Pay Later), and repayment tracking
    - **WFP Integration** - Specialized endpoints for World Food Programme operations
    - **Real-time Reporting** - Comprehensive financial and operational analytics
    - **Multi-country Support** - Ethiopia (ET), Kenya (KE), Senegal (SN), Guinea-Bissau (GW)

    ### üèóÔ∏è Architecture
    - **RESTful Design** - Follows REST principles with predictable resource-oriented URLs
    - **JSON Transport** - All requests and responses in JSON format
    - **Stateless Authentication** - JWT tokens with configurable expiry
    - **Idempotent Operations** - Safe retry for all mutating operations

    ### üìä API Status
    | Environment | URL | Status | Uptime |
    |-------------|-----|--------|--------|
    | Production | `https://api.helloomarket.com/v1` | ‚úÖ Live | 99.95% |
    | Staging | `https://staging-api.helloomarket.com/v1` | üü° Testing | - |
    | Development | `http://localhost:4000` | üöß Development | - |

    ### üöÄ Quick Start
    1. **Get Authentication Token**
    ```bash
    curl -X POST https://api.helloomarket.com/v1/auth/login \
      -H "Content-Type: application/json" \
      -d '{"username":"your_username","password":"your_password"}'
    ```

    2. **Make Your First API Call**
    ```bash
    curl -X GET https://api.helloomarket.com/v1/merchants \
      -H "Authorization: Bearer YOUR_TOKEN" \
      -H "X-API-Key: YOUR_API_KEY"
    ```

    ### ‚ö†Ô∏è Breaking Changes Policy
    - **Major versions** (v1 ‚Üí v2): 6 months deprecation notice
    - **Minor versions** (v1.0 ‚Üí v1.1): 30 days deprecation notice
    - **Patches** (v1.0.0 ‚Üí v1.0.1): No breaking changes

    ### üîê Compliance
    - **PCI DSS** - Payment Card Industry Data Security Standard
    - **GDPR** - General Data Protection Regulation compliant
    - **SOC 2** - Security and compliance controls

    ---
    *Documentation last updated: ${new Date().toISOString().split('T')[0]}*

  version: 1.0.11
  termsOfService: https://helloomarket.com/legal/api-terms
  contact:
    name: HellOOpass API Team
    email: api@helloomarket.com
    url: https://helloomarket.com/support/api
    x-slack: "#api-support"
    x-phone: "+251-11-123-4567"
  license:
    name: HellOOpass Proprietary License
    url: https://helloomarket.com/legal/license
  x-api-maturity: production
  x-service-tier: enterprise
  x-rate-limit-tier: platinum
  x-compliance:
    - pci-dss
    - gdpr
    - soc2

externalDocs:
  description: "üìö Complete Developer Documentation"
  url: "https://developer.helloomarket.com"
  x-tutorials: "https://developer.helloomarket.com/tutorials"
  x-api-status: "https://status.helloomarket.com"
  x-changelog: "https://developer.helloomarket.com/changelog"

servers:
  - url: https://api.helloomarket.com/v1
    description: Production Environment (High Availability)
    variables:
      environment:
        enum: [production]
        default: production
      region:
        enum: [us-east-1, eu-west-1, af-south-1]
        default: af-south-1
    x-availability: 99.95%
    x-sla: "24/7 with 99.9% uptime"
    x-response-time: "<200ms p95"

  - url: https://staging-api.helloomarket.com/v1
    description: Staging Environment (Pre-production)
    x-warning: "Data may be periodically wiped"
    x-purge-schedule: "Every Sunday 02:00 UTC"

  - url: http://localhost:4000
    description: Local Development
    variables:
      port:
        default: "4000"
        description: "Local server port"

# ========================
# üîê SECURITY DEFINITIONS
# ========================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        # JWT Authentication

        All protected endpoints require a valid JWT token obtained from the `/auth/login` endpoint.

        ### Token Format
        ```
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        ```

        ### Token Lifespan
        - **Access Token**: 1 hour
        - **Refresh Token**: 7 days (available via `/auth/refresh`)

        ### Scopes
        | Scope | Description | Endpoints |
        |-------|-------------|-----------|
        | `merchant:read` | Read merchant data | GET /merchants |
        | `merchant:write` | Write merchant data | POST /merchants |
        | `customer:read` | Read customer data | GET /customers |
        | `wfp:admin` | Full WFP administration | All WFP endpoints |

      x-token-example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        # API Key Authentication

        Required for all API calls. Contact support@helloomarket.com to obtain your API key.

        ### Rate Limits by Key Tier
        | Tier | Requests/Second | Daily Limit | Burst |
        |------|-----------------|-------------|-------|
        | Free | 5 | 10,000 | 20 |
        | Basic | 20 | 100,000 | 100 |
        | Business | 100 | 1,000,000 | 500 |
        | Enterprise | 1,000 | Unlimited | 5,000 |

        ### Monitoring
        - Monitor usage at: https://dashboard.helloomarket.com/api-usage
        - Set up alerts: https://dashboard.helloomarket.com/alerts

      x-rate-limit-headers:
        - X-RateLimit-Limit
        - X-RateLimit-Remaining
        - X-RateLimit-Reset

    webhookSignature:
      type: http
      scheme: signature
      description: |
        # Webhook Signature Verification

        All webhooks include a `X-Webhook-Signature` header for verification.

        ### Verification Process
        1. Concatenate timestamp + payload
        2. Compute HMAC-SHA256 with your webhook secret
        3. Compare with received signature

        ### Example Code
        ```javascript
        const crypto = require('crypto');

        function verifyWebhook(payload, signature, secret) {
          const hmac = crypto.createHmac('sha256', secret);
          hmac.update(payload);
          const expected = hmac.digest('hex');
          return crypto.timingSafeEqual(
            Buffer.from(signature),
            Buffer.from(expected)
          );
        }
        ```

  # ========================
  # üì¶ REUSABLE PARAMETERS
  # ========================
  parameters:
    PaginationLimit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 1000
        default: 50
        example: 50
      description: |
        Number of items to return per page.

        ### Performance Guidelines
        - Use smaller limits (10-50) for real-time applications
        - Use larger limits (100-1000) for batch processing
        - Maximum allowed: 1000 items

        ### Cursor-based Pagination
        For large datasets, consider using cursor-based pagination:
        ```
        GET /items?limit=50&cursor=eyJpZCI6IjEyMzQ1Njc4OTAifQ
        ```

      x-performance-impact: "High for large limits"
      x-cache-control: "public, max-age=60"

    PaginationPage:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1
      description: |
        Page number for paginated results.

        ### Notes
        - Combined with `limit` parameter
        - Page numbers start at 1
        - Returns empty array if page exceeds total

      x-related: limit

    PaginationCursor:
      name: cursor
      in: query
      required: false
      schema:
        type: string
        example: "eyJpZCI6IjEyMzQ1Njc4OTAifQ"
      description: |
        Opaque cursor for pagination. Use the `next_cursor` from previous response.

    CountryCode:
      name: countryCode
      in: query
      required: false
      schema:
        type: string
        enum: [ET, KE, SN, GW]
        default: ET
        example: ET
      description: |
        ISO 3166-1 alpha-2 country code.

        ### Supported Countries
        | Code | Country | Currency | Timezone |
        |------|---------|----------|----------|
        | ET | Ethiopia üá™üáπ | ETB | EAT (UTC+3) |
        | KE | Kenya üá∞üá™ | KES | EAT (UTC+3) |
        | SN | Senegal üá∏üá≥ | XOF | GMT (UTC+0) |
        | GW | Guinea-Bissau üá¨üáº | XOF | GMT (UTC+0) |

      x-regional-requirements:
        ET: "Requires merchant registration with National Bank of Ethiopia"
        KE: "Compliant with Central Bank of Kenya regulations"

    MobileNumber:
      name: mobile
      in: query
      required: false
      schema:
        type: string
        pattern: '^\+[1-9]\d{1,14}$'
        example: "+251912345678"
      description: |
        Mobile number in E.164 international format.

        ### Format Examples
        | Country | Example | Notes |
        |---------|---------|-------|
        | Ethiopia | `+251912345678` | 9 digits after country code |
        | Kenya | `+254712345678` | 9 digits after country code |
        | Senegal | `+221701234567` | 8 digits after country code |

      x-validation: "Verified via SMS OTP for sensitive operations"

    DateRangeStart:
      name: startDate
      in: query
      required: false
      schema:
        type: string
        format: date
        example: "2024-01-01"
      description: |
        Start date for filtering (inclusive).

        ### Date Format
        - Format: `YYYY-MM-DD`
        - Timezone: UTC
        - Inclusive: Includes the entire start date

      x-timezone: UTC

    DateRangeEnd:
      name: endDate
      in: query
      required: false
      schema:
        type: string
        format: date
        example: "2024-12-31"
      description: |
        End date for filtering (inclusive).

        ### Business Rules
        - Maximum range: 365 days
        - Must be ‚â• startDate
        - Results include entire end date

      x-max-range: "365 days"

    UserId:
      name: userId
      in: query
      required: false
      schema:
        type: integer
        minimum: 100000
        maximum: 999999
        example: 123456
      description: |
        6-digit unique user identifier.

        ### ID Structure
        ```
        Position 1-2: Country Code (11=ET, 12=KE, 13=SN)
        Position 3-4: User Type (01=Merchant, 02=Customer, 03=Supplier)
        Position 5-6: Sequential number
        ```

        Example: `11010001` = Ethiopian Merchant #0001

      x-id-format: "CCUU####"

    ActiveStatus:
      name: active
      in: query
      required: false
      schema:
        type: string
        enum: ["0", "1", "all"]
        default: "1"
        example: "1"
      description: |
        Filter by active status.

        | Value | Description |
        |-------|-------------|
        | 0 | Inactive only |
        | 1 | Active only |
        | all | Both active and inactive |

      x-default: "1"

  # ========================
  # üìÑ REUSABLE SCHEMAS
  # ========================
  schemas:
    # =========== AUTHENTICATION ===========
    AuthLoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 255
          example: "merchant_123456@helloomarket.com"
          description: "Email or username for authentication"
          x-field-type: email
          x-validation: "RFC 5322 email format"

        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          example: "SecurePass!2024"
          description: "User password"
          x-password-policy:
            minLength: 8
            requireUppercase: true
            requireLowercase: true
            requireNumbers: true
            requireSpecialChars: true
          x-encryption: "bcrypt with 12 rounds"

        twoFactorCode:
          type: string
          pattern: "^[0-9]{6}$"
          example: "123456"
          description: "6-digit 2FA code (if enabled)"
          x-2fa-methods: ["SMS", "TOTP", "Email"]

      example:
        username: "merchant_123456@helloomarket.com"
        password: "SecurePass!2024"
        twoFactorCode: "123456"

    AuthLoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
          description: "Authentication status"

        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          description: "JWT access token"
          x-token-type: "Bearer"
          x-expires-in: 3600

        refreshToken:
          type: string
          example: "def50200f3c..."
          description: "Refresh token for obtaining new access tokens"
          x-expires-in: 604800

        tokenType:
          type: string
          enum: [Bearer]
          default: Bearer
          example: Bearer

        expiresIn:
          type: integer
          example: 3600
          description: "Token expiry in seconds"

        user:
          $ref: "#/components/schemas/UserProfile"

        permissions:
          type: array
          items:
            type: string
          example: ["merchant:read", "customer:write", "invoice:create"]
          description: "Assigned user permissions"

        message:
          type: string
          example: "Authentication successful"

      example:
        success: true
        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken: "def50200f3c..."
        tokenType: "Bearer"
        expiresIn: 3600
        user:
          id: "123456"
          email: "merchant@example.com"
          fullName: "John Doe"
          role: "merchant"
        permissions: ["merchant:read", "customer:write"]
        message: "Authentication successful"

    # =========== MERCHANT SCHEMAS ===========
    Merchant:
      type: object
      required: [userId, fullName, businessName, mobile, countryCode]
      properties:
        userId:
          type: string
          pattern: "^[0-9]{6}$"
          example: "123456"
          description: "6-digit merchant identifier"

        fullName:
          type: string
          minLength: 2
          maxLength: 255
          example: "John Doe"
          description: "Legal full name of merchant owner"

        businessName:
          type: string
          minLength: 2
          maxLength: 255
          example: "Doe Enterprises"
          description: "Registered business name"

        businessRegistrationNumber:
          type: string
          pattern: "^[A-Z0-9]{8,20}$"
          example: "ET12345678"
          description: "Government-issued business registration number"
          x-country-specific:
            ET: "Ministry of Trade registration"
            KE: "Business Registration Service (BRS)"

        mobile:
          $ref: "#/components/schemas/PhoneNumber"

        email:
          type: string
          format: email
          example: "merchant@doe-enterprises.com"
          description: "Business email address"

        countryCode:
          $ref: "#/components/parameters/CountryCode/schema"

        project:
          type: string
          enum: [Palladium, Standard_ET, Standard_KE, Custom]
          example: "Palladium"
          description: "Associated project name"

        active:
          type: string
          enum: ["0", "1"]
          example: "1"
          description: "Account status (1=active, 0=inactive)"

        kycStatus:
          type: string
          enum: [pending, verified, rejected, expired]
          example: "verified"
          description: "KYC verification status"

        kycVerifiedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: "Timestamp of KYC verification"

        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
          description: "Account creation timestamp"

        lastLoginAt:
          type: string
          format: date-time
          example: "2024-01-22T14:30:00Z"
          description: "Last login timestamp"

        wallets:
          type: array
          items:
            $ref: "#/components/schemas/Wallet"
          description: "Associated wallets"

        metadata:
          type: object
          additionalProperties: true
          example:
            category: "retail"
            storeCount: 3
            employeeCount: 5
          description: "Additional merchant information"

      x-audit-trail: true
      x-data-retention: "7 years for financial records"

    MerchantListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true

        data:
          type: array
          items:
            $ref: "#/components/schemas/Merchant"

        pagination:
          $ref: "#/components/schemas/PaginationInfo"

        summary:
          type: object
          properties:
            totalMerchants:
              type: integer
              example: 2792
            activeMerchants:
              type: integer
              example: 2082
            totalBalance:
              type: number
              example: 15000000.50

        _links:
          $ref: "#/components/schemas/HATEOASLinks"

    # =========== WALLET SCHEMAS ===========
    Wallet:
      type: object
      required: [walletId, walletType, balance, currency]
      properties:
        walletId:
          type: string
          pattern: "^[0-9]{10}$"
          example: "1234567890"
          description: "10-digit wallet identifier"

        walletType:
          type: string
          enum:
            [
              MERCHANT_AVAILABLE,
              MERCHANT_CREDIT,
              CUSTOMER_CREDIT,
              SUPPLIER_SETTLEMENT,
            ]
          example: "MERCHANT_AVAILABLE"
          description: "Wallet type classification"

        name:
          type: string
          example: "Main Operating Account"
          description: "Human-readable wallet name"

        balance:
          type: number
          minimum: 0
          example: 1500000.50
          description: "Current wallet balance"
          x-precision: 2

        availableBalance:
          type: number
          minimum: 0
          example: 1200000.00
          description: "Balance available for transactions"

        currency:
          type: string
          enum: [ETB, KES, XOF, USD]
          example: "ETB"
          description: "Wallet currency"

        status:
          type: string
          enum: [active, frozen, closed, restricted]
          example: "active"
          description: "Wallet status"

        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"

        lastTransactionAt:
          type: string
          format: date-time
          example: "2024-01-22T14:30:00Z"

      x-interest-rate: "0.5% per annum"
      x-insured: true

    # =========== PAGINATION SCHEMAS ===========
    PaginationInfo:
      type: object
      properties:
        total:
          type: integer
          example: 2792
          description: "Total number of items"

        count:
          type: integer
          example: 50
          description: "Number of items in current page"

        perPage:
          type: integer
          example: 50
          description: "Items per page"

        currentPage:
          type: integer
          example: 1
          description: "Current page number"

        totalPages:
          type: integer
          example: 56
          description: "Total number of pages"

        hasNextPage:
          type: boolean
          example: true
          description: "True if another page exists"

        hasPreviousPage:
          type: boolean
          example: false
          description: "True if previous page exists"

        nextCursor:
          type: string
          example: "eyJpZCI6IjEyMzQ1Njc4OTAifQ"
          description: "Cursor for next page (cursor-based pagination)"

        previousCursor:
          type: string
          example: "eyJpZCI6IjEyMzQ1Njc4OTAifQ"
          description: "Cursor for previous page"

    # =========== HATEOAS LINKS ===========
    HATEOASLinks:
      type: object
      properties:
        self:
          type: object
          properties:
            href:
              type: string
              example: "/v1/merchants?page=1&limit=50"
            method:
              type: string
              enum: [GET, POST, PUT, DELETE, PATCH]
              example: GET

        next:
          type: object
          properties:
            href:
              type: string
              example: "/v1/merchants?page=2&limit=50"
            method:
              type: string
              example: GET

        previous:
          type: object
          properties:
            href:
              type: string
            method:
              type: string

        first:
          type: object
          properties:
            href:
              type: string
            method:
              type: string

        last:
          type: object
          properties:
            href:
              type: string
            method:
              type: string

    # =========== ERROR RESPONSES ===========
    ErrorResponse:
      type: object
      required: [error, message, code]
      properties:
        error:
          type: boolean
          example: true
          description: "Always true for error responses"

        message:
          type: string
          example: "Invalid authentication token"
          description: "Human-readable error message"

        code:
          type: string
          example: "AUTH_001"
          description: "Machine-readable error code"

        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: "password"
              message:
                type: string
                example: "Password must be at least 8 characters"
          description: "Field-level validation errors"

        traceId:
          type: string
          example: "trace-1234567890abcdef"
          description: "Unique identifier for support requests"

        documentationUrl:
          type: string
          example: "https://developer.helloomarket.com/errors/AUTH_001"
          description: "Link to detailed error documentation"

        timestamp:
          type: string
          format: date-time
          example: "2024-01-22T10:30:00Z"
          description: "When the error occurred"

        requestId:
          type: string
          example: "req_1234567890abcdef"
          description: "Unique request identifier"

      x-error-categories:
        - authentication
        - authorization
        - validation
        - business-rules
        - system

  # ========================
  # ‚ö†Ô∏è STANDARD RESPONSES
  # ========================
  responses:
    Success200:
      description: "‚úÖ Request successful"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
              data:
                type: object
                description: "Response data"
              message:
                type: string
                example: "Operation completed successfully"

    Created201:
      description: "‚úÖ Resource created successfully"
      headers:
        Location:
          schema:
            type: string
          description: "URL of the created resource"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
              id:
                type: string
                example: "123456"
              message:
                type: string
                example: "Resource created successfully"
              location:
                type: string
                example: "/v1/resources/123456"

    BadRequest400:
      description: "‚ùå Bad request - Invalid parameters or malformed request"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            ValidationError:
              summary: "Validation error example"
              value:
                error: true
                message: "Validation failed"
                code: "VAL_001"
                details:
                  - field: "email"
                    message: "Invalid email format"
                  - field: "password"
                    message: "Password must be at least 8 characters"
                traceId: "trace-1234567890abcdef"
                documentationUrl: "https://developer.helloomarket.com/errors/VAL_001"
                timestamp: "2024-01-22T10:30:00Z"

    Unauthorized401:
      description: "üîê Unauthorized - Invalid or missing authentication"
      headers:
        WWW-Authenticate:
          schema:
            type: string
          example: 'Bearer realm="HellOOpass API"'
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Invalid or expired authentication token"
            code: "AUTH_001"
            traceId: "trace-1234567890abcdef"
            documentationUrl: "https://developer.helloomarket.com/errors/AUTH_001"
            timestamp: "2024-01-22T10:30:00Z"

    Forbidden403:
      description: "üö´ Forbidden - Insufficient permissions"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Insufficient permissions to access this resource"
            code: "AUTH_002"
            traceId: "trace-1234567890abcdef"

    NotFound404:
      description: "üîç Resource not found"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Resource not found"
            code: "RES_001"
            traceId: "trace-1234567890abcdef"

    Conflict409:
      description: "‚ö° Conflict - Resource already exists or state conflict"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Resource already exists"
            code: "RES_002"
            traceId: "trace-1234567890abcdef"

    TooManyRequests429:
      description: "üö¶ Rate limit exceeded"
      headers:
        Retry-After:
          schema:
            type: integer
          description: "Seconds to wait before retrying"
          example: 60
        X-RateLimit-Limit:
          schema:
            type: integer
          example: 100
        X-RateLimit-Remaining:
          schema:
            type: integer
          example: 0
        X-RateLimit-Reset:
          schema:
            type: integer
          example: 1617032400
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Rate limit exceeded. Please try again in 60 seconds."
            code: "RATE_001"
            traceId: "trace-1234567890abcdef"

    InternalServerError500:
      description: "üí• Internal server error"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "An unexpected error occurred"
            code: "SYS_001"
            traceId: "trace-1234567890abcdef"
            timestamp: "2024-01-22T10:30:00Z"

    ServiceUnavailable503:
      description: "üîß Service temporarily unavailable"
      headers:
        Retry-After:
          schema:
            type: integer
          example: 300
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: true
            message: "Service undergoing maintenance. Please try again in 5 minutes."
            code: "SYS_002"
            traceId: "trace-1234567890abcdef"

# ========================
# üè∑Ô∏è API TAGS & GROUPS
# ========================
tags:
  - name: Authentication
    description: "User authentication, token management, and session handling"
    externalDocs:
      description: "Authentication Guide"
      url: "https://developer.helloomarket.com/guides/authentication"
    x-sla: "99.99%"
    x-rate-limit: "10 requests/minute"

  - name: Merchants
    description: "Merchant account management, registration, and operations"
    externalDocs:
      description: "Merchant API Guide"
      url: "https://developer.helloomarket.com/guides/merchants"
    x-audit-level: "high"
    x-compliance: ["KYC", "AML"]

  - name: Customers
    description: "Customer management, registration, and transactions"
    x-data-classification: "PII"
    x-retention-period: "7 years"

  - name: Wallets
    description: "Wallet operations, balances, and transfers"
    x-transaction-types: ["credit", "debit", "transfer", "settlement"]
    x-currency-support: ["ETB", "KES", "XOF", "USD"]

  - name: Invoices
    description: "Invoice creation, management, and BNPL operations"
    externalDocs:
      description: "Invoice Processing Guide"
      url: "https://developer.helloomarket.com/guides/invoices"
    x-payment-methods: ["wallet", "bank_transfer", "mobile_money"]

  - name: WFP Operations
    description: "World Food Programme specific operations and integrations"
    externalDocs:
      description: "WFP Integration Guide"
      url: "https://developer.helloomarket.com/guides/wfp"
    x-partner: "World Food Programme"
    x-compliance: ["WFP Standards", "Humanitarian Principles"]

  - name: Reports
    description: "Financial reporting, analytics, and business intelligence"
    x-data-retention: "10 years"
    x-export-formats: ["CSV", "Excel", "PDF", "JSON"]

  - name: Administration
    description: "System administration and management endpoints"
    x-access-level: "admin"
    x-audit-trail: "comprehensive"

# ========================
# üõ£Ô∏è API PATHS
# ========================
paths:
  # =========== AUTHENTICATION ENDPOINTS ===========
  /auth/login:
    post:
      tags: [Authentication]
      summary: "Authenticate user and obtain JWT token"
      description: |
        # User Authentication

        Authenticate a user with username/credentials and receive a JWT token for subsequent API calls.

        ### Authentication Methods
        1. **Username/Password** - Standard credential authentication
        2. **Two-Factor Authentication** - Additional 6-digit code if enabled
        3. **API Key** - For service-to-service authentication

        ### Security Notes
        - Failed attempts are logged and monitored
        - After 5 failed attempts, account is temporarily locked
        - All authentication attempts are audited

        ### Token Lifespan
        - **Access Token**: 1 hour
        - **Refresh Token**: 7 days

      operationId: authenticateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthLoginRequest"
            examples:
              BasicAuth:
                summary: "Basic authentication"
                value:
                  username: "merchant_123456@helloomarket.com"
                  password: "SecurePass!2024"
              With2FA:
                summary: "With 2FA code"
                value:
                  username: "merchant_123456@helloomarket.com"
                  password: "SecurePass!2024"
                  twoFactorCode: "123456"

      responses:
        "200":
          $ref: "#/components/responses/Success200"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthLoginResponse"

        "400":
          $ref: "#/components/responses/BadRequest400"

        "401":
          $ref: "#/components/responses/Unauthorized401"

        "429":
          $ref: "#/components/responses/TooManyRequests429"

        "500":
          $ref: "#/components/responses/InternalServerError500"

      security: []
      x-audit-level: "high"
      x-ip-whitelist: false
      x-rate-limit: "5 requests per minute per IP"

  # =========== MERCHANT ENDPOINTS ===========
  /merchants:
    get:
      tags: [Merchants]
      summary: "List merchants with filtering"
      description: |
        # Retrieve Merchant List

        Get a paginated list of merchants with advanced filtering capabilities.

        ### Use Cases
        - Display merchant directory in admin dashboard
        - Filter merchants by country for regional reporting
        - Search for specific merchants by mobile or name

        ### Performance
        - Response time: < 500ms p95
        - Supports pagination with 1000 merchants per page max
        - Cached for 60 seconds

        ### Business Rules
        - Only active merchants are returned by default
        - Country filtering respects regional permissions
        - Sensitive data masked for non-admin users

      operationId: listMerchants
      parameters:
        - $ref: "#/components/parameters/PaginationLimit"
        - $ref: "#/components/parameters/PaginationPage"
        - $ref: "#/components/parameters/CountryCode"
        - $ref: "#/components/parameters/MobileNumber"
        - $ref: "#/components/parameters/UserId"
        - $ref: "#/components/parameters/ActiveStatus"
        - name: search
          in: query
          description: "Search merchants by name or business name"
          schema:
            type: string
          example: "hello shop"

        - name: sortBy
          in: query
          description: "Field to sort by"
          schema:
            type: string
            enum: [createdAt, businessName, balance]
          example: "createdAt"

        - name: sortOrder
          in: query
          description: "Sort order"
          schema:
            type: string
            enum: [asc, desc]
          example: "desc"

      responses:
        "200":
          description: "Merchant list retrieved successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MerchantListResponse"
              examples:
                SuccessExample:
                  summary: "Successful response with 2 merchants"
                  value:
                    success: true
                    data:
                      - userId: "123456"
                        fullName: "Hello Shop"
                        businessName: "Hello Shop Enterprises"
                        mobile: "+251912345678"
                        countryCode: "ET"
                        project: "Palladium"
                        active: "1"
                        createdAt: "2024-11-12T07:08:55Z"
                        lastLoginAt: "2024-11-15T14:46:27Z"
                        wallets:
                          - walletId: "1234567890"
                            walletType: "MERCHANT_AVAILABLE"
                            balance: 2000000.00
                            currency: "ETB"
                      - userId: "123457"
                        fullName: "Quick Mart"
                        businessName: "Quick Mart Ltd"
                        mobile: "+251987654321"
                        countryCode: "ET"
                        project: "Standard_ET"
                        active: "1"
                        createdAt: "2024-10-10T10:10:10Z"
                        lastLoginAt: "2024-11-14T09:30:00Z"
                        wallets: []
                    pagination:
                      total: 2792
                      count: 2
                      perPage: 50
                      currentPage: 1
                      totalPages: 56
                      hasNextPage: true
                      hasPreviousPage: false
                    summary:
                      totalMerchants: 2792
                      activeMerchants: 2082
                      totalBalance: 15000000.50
                    _links:
                      self:
                        href: "/v1/merchants?page=1&limit=50"
                        method: "GET"
                      next:
                        href: "/v1/merchants?page=2&limit=50"
                        method: "GET"
                      first:
                        href: "/v1/merchants?page=1&limit=50"
                        method: "GET"
                      last:
                        href: "/v1/merchants?page=56&limit=50"
                        method: "GET"
                    message: "Merchants retrieved successfully"

        "400":
          $ref: "#/components/responses/BadRequest400"

        "401":
          $ref: "#/components/responses/Unauthorized401"

        "403":
          $ref: "#/components/responses/Forbidden403"

        "500":
          $ref: "#/components/responses/InternalServerError500"

      security:
        - bearerAuth: []
        - apiKey: []
      x-cache-control: "public, max-age=60"
      x-rate-limit: "100 requests/minute"
      x-required-permissions: ["merchant:read"]

  # =========== WFP ENDPOINTS ===========
  /wfp/categories:
    get:
      tags: [WFP Operations]
      summary: "Get food categories and subcategories"
      description: |
        # Retrieve WFP Food Categories

        Get the complete hierarchy of food categories and subcategories with allocated amounts.
        Used for WFP program planning and beneficiary allocation.

        ### Categories Include
        - **PLW** - Pregnant and Lactating Women
        - **Children** - Children under 5
        - **General** - General population

        ### Data Source
        - Updated daily from WFP central database
        - Regional variations applied automatically
        - Historical data available for 5 years

      operationId: getWfpCategories
      parameters:
        - name: cycleId
          in: query
          description: "Filter by specific program cycle"
          schema:
            type: string
          example: "Ywh8Epr6-CDd3-PgQs-BcRr-vtRYzr8GlTP4"

        - name: region
          in: query
          description: "Filter by geographic region"
          schema:
            type: string
            enum: [africa, asia, middle_east, latin_america]
          example: "africa"

      responses:
        "200":
          description: "Food categories retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        category:
                          type: string
                          example: "PLW"
                          description: "Main category name"

                        description:
                          type: string
                          example: "Pregnant and Lactating Women"

                        nutritionalGuidelines:
                          type: string
                          example: "High protein, iron-rich foods"

                        subcategories:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                example: "11b5cf1c-eda5-0a68-7cd0-675c1b485a8f"

                              name:
                                type: string
                                example: "Oil"

                              allocatedAmount:
                                type: number
                                example: 78.75

                              unit:
                                type: string
                                example: "liters"

                              caloriesPerUnit:
                                type: number
                                example: 8840

                              lastUpdated:
                                type: string
                                format: date-time
                                example: "2024-01-22T10:30:00Z"

                  metadata:
                    type: object
                    properties:
                      totalCategories:
                        type: integer
                        example: 8

                      lastSync:
                        type: string
                        format: date-time

                      wfpVersion:
                        type: string
                        example: "2.1.4"

                  message:
                    type: string
                    example: "Categories retrieved successfully"

              examples:
                SuccessExample:
                  summary: "Successful categories response"
                  value:
                    success: true
                    data:
                      - category: "PLW"
                        description: "Pregnant and Lactating Women"
                        nutritionalGuidelines: "High protein, iron-rich foods"
                        subcategories:
                          - id: "11b5cf1c-eda5-0a68-7cd0-675c1b485a8f"
                            name: "Oil"
                            allocatedAmount: 78.75
                            unit: "liters"
                            caloriesPerUnit: 8840
                            lastUpdated: "2024-01-22T10:30:00Z"
                      - category: "Children"
                        description: "Children under 5"
                        nutritionalGuidelines: "Fortified foods, micronutrients"
                        subcategories:
                          - id: "22c6dg2d-feb6-1b79-8de1-786d2c596b9g"
                            name: "Fortified Cereal"
                            allocatedAmount: 50.00
                            unit: "kg"
                            caloriesPerUnit: 3500
                            lastUpdated: "2024-01-22T10:30:00Z"
                    metadata:
                      totalCategories: 2
                      lastSync: "2024-01-22T10:30:00Z"
                      wfpVersion: "2.1.4"
                    message: "Categories retrieved successfully"

        "401":
          $ref: "#/components/responses/Unauthorized401"

        "403":
          $ref: "#/components/responses/Forbidden403"

        "500":
          $ref: "#/components/responses/InternalServerError500"

      security:
        - bearerAuth: []
        - apiKey: []
      x-wfp-compliance: true
      x-humanitarian-data: true
      x-required-permissions: ["wfp:read"]

# ========================
# üîß WEBHOOKS
# ========================
webhooks:
  invoice.paid:
    post:
      description: "Triggered when an invoice is successfully paid"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                event:
                  type: string
                  example: "invoice.paid"
                data:
                  type: object
                  properties:
                    invoiceId:
                      type: string
                    amount:
                      type: number
                    paidAt:
                      type: string
                      format: date-time
                webhookId:
                  type: string
                timestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: "Webhook received successfully"
        "400":
          description: "Bad webhook payload"

# ========================
# ‚öôÔ∏è GLOBAL CONFIGURATION
# ========================
security:
  - bearerAuth: []
  - apiKey: []

x-production-ready: true
x-api-versioning-strategy: uri
x-deprecation-policy: "6 months notice"
x-sla-commitment: "99.9% uptime"
x-support-channels:
  - "Email: api-support@helloomarket.com"
  - "Slack: #api-support"
  - "Phone: +251-11-123-4567 (24/7)"
x-monitoring:
  - "https://status.helloomarket.com"
  - "https://grafana.helloomarket.com"
x-compliance-frameworks:
  - name: "PCI DSS"
    level: "Level 1"
  - name: "GDPR"
    applicable: true
  - name: "SOC 2"
    type: "Type II"
x-documentation-generation:
  tools:
    - "Redoc"
    - "Swagger UI"
    - "Postman"
  auto-generate: true
x-testing-environments:
  - name: "sandbox"
    url: "https://sandbox-api.helloomarket.com"
    description: "Test with mock data"
  - name: "staging"
    url: "https://staging-api.helloomarket.com"
    description: "Pre-production with real data"
x-performance-metrics:
  p95-response-time: "< 500ms"
  availability: "99.95%"
  max-concurrent-users: "10,000"
  throughput: "1000 req/sec"
x-backward-compatibility:
  guarantee: "2 major versions"
  deprecation-notice: "6 months"
x-rate-limiting:
  strategy: "token bucket"
  burst-allowed: true
  by:
    - "apiKey"
    - "IP"
    - "user"
